<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="chat-header-main">
                <div class="chat-header-left">
                    <h1 data-i18n="title">Secure Chat</h1>
                    <span class="chat-subtitle" data-i18n="subtitle">轻量级端到端加密聊天室</span>
                </div>
                <div class="chat-header-right">
                    <div class="chat-control-group">
                        <div class="control-item">
                            <label for="profile-select" class="control-label" data-i18n="profileLabel">身份</label>
                            <div class="control-inline">
                                <select id="profile-select" class="control-select">
                                    <!-- 选项由脚本动态填充 -->
                                </select>
                                <button
                                    id="profile-add-btn"
                                    class="control-icon-button"
                                    type="button"
                                    data-i18n-title="profileAddTitle"
                                    title="创建新身份"
                                >
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button
                                    id="profile-edit-btn"
                                    class="control-icon-button"
                                    type="button"
                                    data-i18n-title="profileEditTitle"
                                    title="编辑当前身份"
                                >
                                    <i class="fas fa-user-astronaut"></i>
                                </button>
                            </div>
                        </div>
                        <div class="control-item">
                            <label for="theme-select" class="control-label" data-i18n="themeLabel">主题</label>
                            <select id="theme-select" class="control-select">
                                <option value="auto" data-i18n="themeAuto">跟随系统</option>
                                <option value="light" data-i18n="themeLight">浅色</option>
                                <option value="dark" data-i18n="themeDark">深色</option>
                            </select>
                        </div>
                        <div class="control-item">
                            <label for="lang-select" class="control-label" data-i18n="langLabel">语言</label>
                            <select id="lang-select" class="control-select">
                                <option value="zh-CN" data-i18n="langZh">中文</option>
                                <option value="en" data-i18n="langEn">English</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="chat-messages" id="messages"></div>
        <div class="chat-input-container">
            <form id="chat-form" class="chat-input">
                <input
                    id="chat-input"
                    type="text"
                    autocomplete="off"
                    data-i18n-placeholder="inputPlaceholder"
                    placeholder="Type a message..."
                >
                <label for="image-upload" class="image-upload-label" title="发送图片">
                    <i class="fas fa-photo-film"></i>
                </label>
                <input type="file" id="image-upload" accept="image/*" style="display: none;">
                <button type="submit" title="发送">
                    <i class="fas fa-arrow-up"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- 身份配置弹窗 -->
    <div id="profile-modal" class="modal-overlay" aria-hidden="true">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title-group">
                    <div class="modal-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="modal-title-text">
                        <h2 data-i18n="profileModalTitle">编辑身份</h2>
                        <p class="modal-subtitle" data-i18n="profileModalSubtitle">
                            为当前身份设置昵称与加密密钥，只保存在本地浏览器
                        </p>
                    </div>
                </div>
                <button class="modal-close" id="profile-modal-close" type="button" aria-label="Close">
                        <i class="fas fa-xmark"></i>
                </button>
            </div>
            <form id="profile-form" class="modal-body">
                <div class="field-group">
                    <div class="field-label-row">
                        <label for="profile-nickname" data-i18n="profileNicknameLabel">昵称</label>
                        <span class="field-hint" data-i18n="profileNicknameHint">会显示在消息上方和头像文字中</span>
                    </div>
                    <div class="field-input-with-icon">
                        <span class="field-icon">
                            <i class="fas fa-user"></i>
                        </span>
                        <textarea
                            id="profile-nickname"
                            class="field-textarea auto-resize"
                            rows="1"
                            maxlength="40"
                            data-autoresize="true"
                            data-i18n-placeholder="profileNicknamePlaceholder"
                            placeholder="输入一个你喜欢的昵称"
                        ></textarea>
                    </div>
                </div>

                <div class="field-group">
                    <div class="field-label-row">
                        <label for="profile-key" data-i18n="profileKeyLabel">加密密钥</label>
                        <span class="field-hint" data-i18n="profileKeyHint">
                            仅本地使用，不会上传服务器；同一个密钥的用户之间才能互相解密
                        </span>
                    </div>
                    <div class="field-input-with-icon">
                        <span class="field-icon">
                            <i class="fas fa-lock"></i>
                        </span>
                        <textarea
                            id="profile-key"
                            class="field-textarea auto-resize"
                            rows="1"
                            data-autoresize="true"
                            data-i18n-placeholder="profileKeyPlaceholder"
                            placeholder="为当前身份设置一个加密密钥"
                        ></textarea>
                    </div>
                </div>

                <div class="field-group">
                    <div class="field-label-row">
                        <label for="profile-color" data-i18n="profileColorLabel">身份颜色</label>
                        <span class="field-hint" data-i18n="profileColorHint">用于头像和自己消息的气泡颜色</span>
                    </div>
                    <div class="field-input-with-icon field-color-row">
                        <span class="field-icon">
                            <i class="fas fa-palette"></i>
                        </span>
                        <textarea
                            id="profile-color"
                            class="field-textarea"
                            rows="1"
                            data-i18n-placeholder="profileColorPlaceholder"
                            placeholder="#4F46E5"
                        ></textarea>
                        <input type="color" id="profile-color-picker" class="field-color-input">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="profile-modal-cancel" data-i18n="profileCancel">
                        取消
                    </button>
                    <button type="submit" class="btn-primary" data-i18n="profileSave">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>